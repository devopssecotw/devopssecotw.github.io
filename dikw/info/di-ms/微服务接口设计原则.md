# ms
## 微服务接口设计原则
### 高可用
#### 降级兜底
#### 过载保护 （保护自己）
- 请求等待时间超时
- 服务过载及早拒绝
#### 流量控制（保护下游）
- 下游有严格的请求限制
- 调用的下游不是为高并发场景设计
- 失败重试
#### 快速失败
- 设置超时时间
#### 无状态服务
#### 最少依赖
#### 简单可靠
#### 分散原则
- 基于主次进行服务拆分
#### 隔离原则
#### 幂等设计（可重入）
#### 故障自愈
#### CAP 定理
- 一致性（Consistency）
- 可用性（Availability）
- 分区容错性（Partition tolerance）
#### BASE 理论
- Basically Available（基本可用）
- Soft state（ 软状态）
- Eventual consistency（最终一致性）
### 高性能
#### 无锁
- 锁的问题
- 串行无锁
#### 缓存
- 为什么要有缓存？ 数据的访问具有局部性，符合二八定律
- 缓存的使用场景: 
一旦生成后基本不会变化的数据; 
读密集型或存在热点的数据;
 计算代价大的数据; 
 千人一面的数据
- 不适合使用缓存的场景
- 写多读少，更新频繁
- 对数据一致性要求严格
#### 缓存的分类
- 进程级缓存
- 集中式缓存
- 分布式缓存
- 多级缓存
#### 缓存的使用模式
- Cache-Aside：旁路缓存
- Cache-as-SoR：缓存即数据源
Read-Through：称为穿透读模式
Write-Through：称为穿透写模式
Write-Behind：称为回写模式
#### 缓存淘汰策略
- 基于时间 TTL（Time To Live）：即存活期; TTI（Time To Idle）：即空闲期
- 基于空间：缓存设置了存储空间上限
- 基于容量：缓存设置了存储条目上限
- 基于引用：基于引用计数或者强弱引用的一些策略进行回收
- FIFO（First In First Out）：先进选出原则
- LRU（Least Recently Used）：最基于局部性原理
- LFU：（Least Frequently Used）：最近最少被使用的数据最先被淘汰
#### 缓存的崩溃与修复
- 缓存穿透
- 缓存雪崩
- 缓存热点
#### 缓存的一些好实践
- 动静分离
- 慎用大对象
- 过期设置
- 超时设置
- 缓存隔离
- 失败降级
- 容量控制
- 业务导向
- 监控告警
#### 异步
##### 调用异步
- Callback
- Future
- CPS（Continuation-passing style）
##### 流程异步
#### 池化
##### 为什么要池化
- 避免资源重复创建、删除来提高性能
##### 内存池
##### 线程池
##### 连接池
##### 对象池
#### 批量
#### 并发
##### 请求并发
##### 冗余请求
#### 存储设计
##### 读写分离
- 写后读一致
- 二次读取
- 区分场景
- 单调读
##### 分库分表
- 单表的数据量达到了一定的量级
- 数据库吞吐量达到瓶颈
- 垂直切分
- 水平切分
##### 动静分离
##### 冷热分离
##### 重写轻读
##### 数据异构
- 数据格式的异构
- 数据存储地点的异构
- 数据存储逻辑的异构
#### 零拷贝
##### 为什么要实现零拷贝
##### 内存映射
##### 零拷贝
### 易维护
#### 充分必要
#### 单一职责
#### 内聚解耦
#### 开闭原则
#### 统一原则
#### 用户重试
#### 最小惊讶
#### 避免无效请求
#### 入参校验
#### 设计模式
#### 禁用 flag 标识
#### 页宜小不宜大
### 低风险 
#### 防 XSS
##### 简介 Cross Site Scripting
- XSS 本质是 HTML 注入
##### 分类
- 存储型（持久型）
- 反射型（非持久型）
- DOM 型 
#####  防御措施
- 攻击者提交恶意代码
- 浏览器执行恶意代码
- 预防存储型和反射型 XSS 攻击
- 输入校验
- 改成纯前端渲染，把代码和数据分隔开
- 拼接 HTML 时转义
- 预防 DOM 型 XSS 攻击
- 其他手段
- Content Security Policy
- HTTP-only Cookie
- 验证码
- 主动检测和发现
#### 防 CSRF Cross Site Request Forgery 
##### 简介
##### 防御措施
- CSRF（通常）发生在第三方域名
- CSRF 攻击者不能获取到 Cookie 等信息，只是使用
- 同源检测：验证 HTTP Referer 字段
- Samesite Cookie
- CSRF Token
- 双重 Cookie 验证
#### 防 SQL 注入
#### 防刷
#### 防篡改
#### 防重放
#### 防 DDoS Distributed Denial of Service
##### 网络层攻击
- ICMP Flood 攻击
- UDP 反射攻击 DNS 反射攻击
##### 传输层攻击
- SYN Flood 攻击
- Connection Flood 攻击
- UDP Flood 攻击
##### 会话层攻击
- SSL 连接攻击
##### 应用层攻击
- HTTP Get 攻击
- UDP DNS Query Flood 攻击
##### 防御 DDoS 攻击的策略方法
- 定期检查服务器漏洞
- 隐藏服务器真实 IP
- 关闭不必要的服务或端口
- 购买高防服务器提高承受能力
- 限制 SYN/ICMP 流量
- 黑名单
- DDoS 清洗
- CDN 加速



### references
- [微服务接口设计原则](https://mp.weixin.qq.com/s/3UNL1EZfgfGkQcdbwuMj8Q)